name: Sync docs to component READMEs
on:
  push:
    paths:
      - basic.md
      - components/**.md
  workflow_dispatch:
jobs:
  sync:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - repo: drone-platform-server
            component: server
          - repo: drone-platform-client
            component: client
          - repo: drone-platform-monitoring-server
            component: monitoring-server
          - repo: drone-platform-trans-tester
            component: trans-tester
    steps:
      - name: Checkout docs repo
        uses: actions/checkout@v3
      - name: Build README
        run: |
          echo "" >> README.md
          cat components/${{ matrix.component }}.md >> README.md
          echo "" > README.md
          cat BASE_README.md >> README.md
      - name: Clone target repo
        run: |
          git clone https://x-access-token:${{ secrets.DOCS_PUSH_TOKEN }}@github.com/seyun4047/${{ matrix.repo }}.git target
      - name: Copy README
        run: |
          cp README.md target/README.md
      - name: Commit and push
        run: |
          cd target
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add README.md
          git commit -m "docs: sync README from drone-platform-docs" || echo "No changes"
          git push
